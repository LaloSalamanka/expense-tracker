# 存錢記帳

信用卡結帳日自動判斷、預估每月可存現金的記帳工具。

支援 Google 帳號登入，資料自動同步雲端（Firebase）。也可以不登入，以本地模式使用。離線時也能正常記帳，連線後自動同步。

---

## 在手機上安裝

這是一個 PWA（Progressive Web App），不需要從 App Store 或 Google Play 下載，直接透過瀏覽器即可安裝到手機桌面。

### iPhone (iOS Safari)

1. 用 **Safari** 開啟以下網址（必須用 Safari，Chrome 等瀏覽器不支援 iOS 的安裝功能）：

   ```
   https://lalosalamanka.github.io/expense-tracker/
   ```

2. 點擊畫面底部的 **分享按鈕**（正方形搭配向上箭頭的圖示 ↑）

3. 在彈出選單中向下滑動，找到並點擊 **「加入主畫面」**

4. 確認名稱後點擊右上角的 **「新增」**

5. 回到主畫面就會看到「存錢記帳」的圖示，點擊即可像一般 App 使用

### Android (Chrome)

1. 用 **Chrome** 開啟以下網址：

   ```
   https://lalosalamanka.github.io/expense-tracker/
   ```

2. Chrome 可能會在畫面底部自動彈出 **「新增至主畫面」** 的提示，直接點擊即可

3. 如果沒有自動提示，點擊右上角的 **「⋮」選單**，然後選擇 **「新增至主畫面」** 或 **「安裝應用程式」**

4. 確認後即會在主畫面出現「存錢記帳」的圖示

---

## 登入與資料同步

### 兩種使用模式

首次開啟 App 時，可以選擇：

- **Google 帳號登入** — 資料自動同步至雲端，換手機、多裝置都能共用，不怕資料遺失
- **本地模式（先不登入）** — 資料只存在手機瀏覽器中，之後可隨時從設定頁登入

### 本地模式轉雲端

1. 先用本地模式記帳一段時間
2. 進入「設定」頁面，點擊「登入 Google 帳號」
3. 登入成功後，本地資料會自動推送到雲端

### 雲端同步機制

- 每次記帳、修改、刪除後，資料會在 1 秒內自動同步至雲端
- 開啟 App 時自動從雲端拉取最新資料
- 離線時記帳不受影響，連線後自動同步
- 設定頁有 🔄 按鈕可手動觸發同步

### 登出

- 設定頁點擊「登出」，App 會切換為本地模式繼續使用
- 資料仍保留在本地，不會消失

---

## 首次設定

第一次使用 App 時（或登入後尚未完成設定），會自動進入 3 步驟設定精靈：

1. **每月收入** — 設定固定收入項目（預設一筆「薪資」，可新增更多）
2. **每月固定支出** — 設定固定支出項目（預設「房租」「保險費」「水電瓦斯」，可自行調整）
3. **信用卡確認** — 檢視並新增信用卡，或選擇僅用現金記帳

完成後即可開始記帳。設定項目可隨時在「設定」頁面修改。

> 已有舊資料的使用者會自動跳過設定精靈，舊格式的收支設定會自動遷移為新的細項格式。

---

## 頁面功能說明

App 底部有四個分頁，以下逐一說明。

### 1. 記帳（輸入頁）

這是打開 App 後的預設頁面，用來快速記錄一筆支出或收入。

#### 支出 / 收入切換

頁面頂部有「**支出**」和「**收入**」兩個按鈕，可切換記錄模式：

- **支出模式**：記錄花費，金額以 `$` 顯示
- **收入模式**：記錄額外收入（獎金、退款等），金額以綠色 `+$` 顯示

#### 金額輸入

畫面中央是大字顯示的金額數字，透過下方的數字鍵盤輸入金額（最多 7 位數）。按左下角的刪除鍵可逐位刪除。

#### 付款方式

金額下方是付款方式選擇列，可選擇「現金」或任一張已設定的信用卡。選中時會以該卡片的代表色標示。收入模式下此選項會自動隱藏（收入不需要選擇付款方式）。

#### 類別選擇

內建類別：

- **支出類別**：🍜 餐飲 ／ ⛽ 交通 ／ 🛒 購物 ／ 🎬 娛樂 ／ 🏥 醫療 ／ 🏠 日用 ／ 🛡️ 保險 ／ 📦 其他
- **收入類別**：🎁 獎金 ／ 💳 退款 ／ 🤝 代墊回收 ／ 💼 副業 ／ 🏦 利息 ／ 💵 其他收入

此外，可在「設定」頁面自訂新增分類（支出與收入各自獨立），自訂分類支援自選 emoji 圖示。

#### 日期 & 備註

- **日期**：預設為今天，可點擊日期欄位選擇其他日期
- **備註**：選填欄位，可輸入這筆消費的說明文字（最多 30 字）

#### 帳單歸屬提示

選擇信用卡付款時，頁面底部會即時顯示這筆消費的帳單歸屬資訊，例如：

- `📋 2026/02 帳單（本月帳單）→ 繳款 2026/03/07` — 表示此筆會歸入 2 月帳單，3/7 前繳款
- `💵 現金即時支出` — 現金消費，無帳單週期
- `💰 額外收入` — 收入模式

#### 送出

按下右下角的「**記帳**」（或收入模式下的「**記收入**」）按鈕即完成記錄。成功後會顯示綠色提示訊息。

---

### 2. 報表

按月顯示收支摘要與信用卡帳單分析。頂部有左右箭頭可切換月份。

#### 預估下月可存現金

最上方的重點卡片，計算公式為：

```
每月可用餘額 + 本月額外收入 − 下月信用卡帳單 − 本月現金支出 ＝ 預估可存金額
```

- 正數：顯示綠色，表示有結餘
- 負數：顯示紅色，表示可能超支

#### 下月需繳信用卡帳單

顯示歸屬於本月、下個月需要繳款的信用卡帳單總額。下方列出各信用卡的個別金額。

#### 本月現金支出

本月所有使用現金的消費總額。

#### 本月額外收入

如果本月有記錄收入（獎金、退款等），會額外顯示此區塊。

#### 每月可用餘額

由「設定」頁面中的「每月收入合計 − 每月固定支出合計」計算而來。收入與固定支出可設定多個細項（如薪資、接案；房租、保險費等），系統自動加總。

#### 本月消費明細（依付款方式）

列出本月各付款方式（現金、各信用卡）的消費金額。

---

### 3. 明細

顯示每一筆交易記錄的詳細列表。頂部有月份切換箭頭。

#### 月份切換

- 用左右箭頭切換檢視不同月份
- 每個月份會同時顯示：該月日期的消費 **以及** 帳單歸屬到該月的跨月消費
- 例如：檢視 2 月時，會看到 1/31 的信用卡消費（因其帳單歸屬 2 月）

#### 日期分組

同一天的消費會歸在同一個區塊中，區塊標頭顯示：

- 左側：日期與星期（例如 `2/8 (六)`）
- 右側：當日淨額（支出為紅色，收入為綠色）

#### 帳單標籤

每筆記錄旁會顯示帳單狀態標籤，**會根據你正在檢視的月份動態變化**：

- **本月帳單**（綠色）— 帳單歸屬在你正在看的這個月
- **下月帳單**（紅色）— 帳單會歸到下個月才需繳款
- **即時支出**（藍色）— 現金消費，無帳單週期
- **即時收入**（綠色）— 收入記錄

例如同一筆 1/31 的信用卡消費：
- 在 1 月的明細頁面 → 顯示「下月帳單」
- 在 2 月的明細頁面 → 顯示「本月帳單」

#### 篩選標籤

日期下方有一排篩選按鈕，可快速過濾：

- **全部** — 顯示所有記錄
- **收入** — 只顯示收入
- **本月帳單** — 只顯示帳單歸屬本月的信用卡消費
- **下月帳單** — 只顯示帳單歸屬下月的信用卡消費
- **即時支出** — 只顯示現金消費
- **各信用卡名稱** — 只顯示該卡的消費

#### 編輯與刪除

- 點擊任一筆記錄可開啟編輯視窗，修改日期、金額、付款方式、類別、備註
- 點擊 🗑️ 按鈕可刪除該筆記錄（會跳出確認對話框）

---

### 4. 設定

管理帳號、收支設定、信用卡、資料備份。

#### 帳號

- **已登入**：顯示 Google 頭像、名稱、Email，可手動同步（🔄）或登出
- **未登入**：顯示「登入 Google 帳號」按鈕，點擊即可從本地模式轉為雲端同步

#### 每月收入

以列表方式設定多筆收入細項（如薪資、接案、投資等），每筆可填名稱與金額。支援新增、編輯、刪除，系統自動加總。

#### 每月固定支出

以列表方式設定多筆固定支出細項（如房租、保險費、水電瓦斯等），同樣支援新增、編輯、刪除。

#### 每月可用餘額

自動計算（收入合計 − 固定支出合計），用於報表的存款預估。

#### 自訂分類

管理支出與收入的自訂分類標籤：

- 內建分類（餐飲、交通等）不可刪除，以半透明樣式顯示
- 點擊「＋ 新增支出分類」或「＋ 新增收入分類」可新增自訂類別
- 每個自訂分類可設定名稱與 emoji 圖示（從 20 個預設圖示中選擇）
- 點擊已有的自訂分類可編輯或刪除
- 刪除分類後，已使用該分類的記錄不會被刪除

#### 信用卡管理

列出所有已新增的信用卡，每張卡片顯示：

- 卡片名稱與代表色
- 結帳日（每月幾號結帳）與繳款日（次月幾號繳款）

操作：

- 點擊 ✏️ 編輯卡片資訊（名稱、結帳日、繳款日、顏色）
- 點擊 🗑️ 刪除卡片
- 點擊「＋ 新增信用卡」新增一張卡

> **結帳日說明**：例如結帳日為 21 號，表示每月 22 日 ~ 次月 21 日的消費會歸入同一期帳單。

#### 備份與還原

- **備份所有資料**：將所有消費記錄、信用卡設定、收支設定匯出為一個 `.json` 檔案。建議定期備份並存到雲端硬碟。
- **還原備份**：選擇之前下載的 `.json` 備份檔案，即可完整恢復所有資料。還原後資料也會同步到雲端。
- **同步時自動備份本地資料**：開關預設關閉。開啟後，每次從雲端同步覆蓋本地資料前，會自動下載一份本地備份 `.json` 檔案，避免資料意外遺失。

#### 匯出 CSV

選擇月份後點擊「匯出該月 CSV」，會下載一個 `.csv` 試算表檔案，包含：

- 該月每筆交易的日期、類型、類別、備註、金額、付款方式、帳單狀態
- 月度摘要（消費總額、現金支出、信用卡帳單、預估存款等）

可用 Excel 或 Google Sheets 開啟。

#### 資料狀態

顯示目前的記錄筆數與佔用空間（瀏覽器 localStorage 上限約 5 MB）。

#### 清除所有消費記錄

點擊紅色按鈕可清除全部消費記錄（已登入時會同時清除雲端資料）。此操作無法復原，請確保已先備份。

---

## 資料備份與還原

即使有雲端同步，仍建議定期手動備份作為額外保險。

### 備份

1. 打開 App → 切換到 **「設定」** 頁面
2. 點擊 **「備份所有資料」**
3. 會下載一個 `記帳備份_YYYY-MM-DD.json` 檔案
4. 將此檔案保存到雲端硬碟（iCloud、Google Drive 等）

### 還原

1. 打開 App → 切換到 **「設定」** 頁面
2. 點擊 **「還原備份」**
3. 選擇之前下載的 `.json` 備份檔案
4. 還原完成後，所有消費記錄、信用卡設定、收支設定都會恢復
5. 如已登入 Google 帳號，還原的資料會自動同步到雲端

### 換手機時的資料轉移

**已登入 Google 帳號**：在新手機上安裝 App 並登入同一個 Google 帳號即可，資料會自動從雲端同步。

**本地模式**：
1. 在舊手機上執行「備份所有資料」
2. 將備份的 `.json` 檔案透過 AirDrop、Line、雲端硬碟等方式傳到新手機
3. 在新手機上安裝此 App（依照上方安裝步驟）
4. 進入「設定 → 還原備份」，選擇該 `.json` 檔案即可
