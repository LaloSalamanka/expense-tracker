:root {
  --bg: #f2f2f7;
  --surface: #ffffff;
  --surface2: #f0f0f0;
  --surface3: #e5e5e5;
  --border: #d1d1d6;
  --text: #1c1c1e;
  --text2: #6e6e73;
  --text3: #aeaeb2;
  --accent: #10b981;
  --accent-dim: rgba(16,185,129,.10);
  --red: #ef4444;
  --red-dim: rgba(239,68,68,.10);
  --blue: #3b82f6;
  --blue-dim: rgba(59,130,246,.10);
  --radius: 16px;
  --radius-sm: 10px;
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --tab-height: 64px;
}

* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
html, body {
  height:100%; background:var(--bg); color:var(--text);
  font-family:'Noto Sans TC',sans-serif; overflow:hidden; touch-action:manipulation;
}

/* ===== Tab Bar ===== */
.tab-bar {
  position:fixed; bottom:0; left:0; right:0;
  height:calc(var(--tab-height) + var(--safe-bottom));
  padding-bottom:var(--safe-bottom);
  background:rgba(255,255,255,.95);
  backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px);
  display:flex; border-top:1px solid var(--border); z-index:100;
}
.tab-item {
  flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center;
  gap:3px; color:var(--text3); font-size:10px; font-weight:500;
  cursor:pointer; transition:color .2s; background:none; border:none; font-family:inherit;
}
.tab-item.active { color:var(--accent); }
.tab-item svg { width:24px; height:24px; }

/* ===== Page ===== */
.page {
  position:fixed; top:0; left:0; right:0;
  bottom:calc(var(--tab-height) + var(--safe-bottom));
  padding-top:var(--safe-top);
  overflow-y:auto; overflow-x:hidden; display:none;
  -webkit-overflow-scrolling:touch;
}
.page.active { display:block; }
.page-header { padding:16px 20px 12px; font-size:22px; font-weight:700; letter-spacing:-.3px; }

/* ===== Type Toggle ===== */
.type-toggle {
  display:flex; gap:4px; padding:0 16px 8px;
  background:var(--surface2); border-radius:12px;
  margin:0 16px 8px; padding:4px;
}
.type-btn {
  flex:1; padding:8px 0; border-radius:10px;
  font-size:14px; font-weight:600; text-align:center;
  border:none; background:transparent;
  color:var(--text3); cursor:pointer; font-family:inherit;
  transition:all .2s;
}
.type-btn.active[data-type="expense"] { background:var(--surface); color:var(--text); box-shadow:0 1px 3px rgba(0,0,0,.08); }
.type-btn.active[data-type="income"] { background:var(--accent-dim); color:var(--accent); }

/* ===== Amount Display ===== */
.amount-display { text-align:center; padding:24px 0 16px; }
.amount-display .label { font-size:13px; color:var(--text2); margin-bottom:8px; min-height:24px; }
.amount-display .value {
  font-family:'JetBrains Mono',monospace; font-size:48px; font-weight:600;
  letter-spacing:-2px; color:var(--text); min-height:60px;
}
.amount-display .value.empty { color:var(--text3); }
.amount-display .value.income { color:var(--accent); }
.amount-display .value.income.empty { color:rgba(16,185,129,.35); }

/* ===== Chips ===== */
.chip-row, .payment-selector, .detail-filters {
  display:flex; gap:8px; padding:0 16px 12px;
  overflow-x:auto; scrollbar-width:none;
}
.chip-row::-webkit-scrollbar, .payment-selector::-webkit-scrollbar, .detail-filters::-webkit-scrollbar { display:none; }
.pay-chip, .filter-chip {
  flex-shrink:0; padding:8px 14px; border-radius:20px;
  font-size:13px; font-weight:500;
  border:1.5px solid var(--border); background:transparent;
  color:var(--text2); cursor:pointer; transition:all .2s;
  white-space:nowrap; font-family:inherit;
}
.pay-chip.active { border-color:var(--accent); color:var(--accent); background:var(--accent-dim); }
.filter-chip.active { border-color:var(--accent); color:var(--accent); background:var(--accent-dim); }

/* ===== Category Grid ===== */
.category-grid {
  display:grid; grid-template-columns:repeat(4,1fr); gap:8px; padding:0 16px 12px;
}
.cat-btn {
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  gap:4px; padding:12px 4px; border-radius:var(--radius-sm);
  background:var(--surface); border:1.5px solid transparent;
  color:var(--text2); font-size:11px; font-weight:500;
  cursor:pointer; transition:all .15s; font-family:inherit;
}
.cat-btn .icon { font-size:22px; }
.cat-btn.active { border-color:var(--accent); color:var(--accent); background:var(--accent-dim); }

/* ===== Note Row ===== */
.note-row { display:flex; gap:8px; padding:0 16px 12px; align-items:center; }
.note-input {
  flex:1; padding:10px 14px; background:var(--surface);
  border:1.5px solid var(--border); border-radius:var(--radius-sm);
  color:var(--text); font-size:14px; font-family:inherit; outline:none;
}
.note-input:focus { border-color:var(--accent); }
.note-input::placeholder { color:var(--text3); }
.date-picker {
  flex-shrink:0; padding:10px 14px; background:var(--surface);
  border:1.5px solid var(--border); border-radius:var(--radius-sm);
  color:var(--text); font-size:14px; font-family:'JetBrains Mono',monospace;
  outline:none; -webkit-appearance:none;
}
.date-picker:focus { border-color:var(--accent); }

/* ===== Numpad ===== */
.numpad {
  display:grid; grid-template-columns:repeat(3,1fr); gap:1px;
  padding:0 16px 12px; background:var(--border);
  border-radius:var(--radius); overflow:hidden;
}
.num-btn {
  background:var(--surface); border:none; color:var(--text);
  font-family:'JetBrains Mono',monospace; font-size:22px; font-weight:500;
  padding:16px 0; cursor:pointer; transition:background .1s;
  display:flex; align-items:center; justify-content:center;
}
.num-btn:active { background:var(--surface3); }
.num-btn.confirm {
  background:var(--accent); color:#fff;
  font-family:'Noto Sans TC',sans-serif; font-size:16px; font-weight:700;
}
.num-btn.confirm:active { opacity:.8; }
.num-btn.confirm.income { background:var(--blue); }
.num-btn.del svg { width:22px; height:22px; }

/* ===== Billing Tag ===== */
.billing-tag {
  display:inline-flex; align-items:center; gap:4px;
  padding:2px 8px; border-radius:6px; font-size:11px; font-weight:600;
}
.billing-tag.this-month { background:var(--accent-dim); color:var(--accent); }
.billing-tag.next-month { background:var(--red-dim); color:var(--red); }
.billing-tag.instant { background:var(--blue-dim); color:var(--blue); }
.billing-tag.income { background:var(--accent-dim); color:var(--accent); }
.billing-tag.prev-month { background:rgba(245,158,11,.12); color:#d97706; }

/* ===== Summary Cards ===== */
.summary-cards { display:flex; flex-direction:column; gap:12px; padding:0 16px 16px; }
.s-card {
  padding:18px; border-radius:var(--radius);
  background:var(--surface); border:1px solid var(--border);
}
.s-card .s-label { font-size:13px; color:var(--text2); margin-bottom:6px; }
.s-card .s-hint { font-size:11px; color:var(--text3); }
.s-card .s-value {
  font-family:'JetBrains Mono',monospace; font-size:28px; font-weight:600; letter-spacing:-1px;
}
.s-card .s-sub {
  font-size:12px; color:var(--text3); margin-top:10px;
  line-height:2; font-family:'JetBrains Mono',monospace;
  padding:10px 12px; background:var(--surface2); border-radius:var(--radius-sm);
}
.s-card.highlight {
  background:linear-gradient(135deg,rgba(16,185,129,.08),rgba(16,185,129,.03));
  border-color:rgba(16,185,129,.25);
}
.s-card.highlight .s-value { color:var(--accent); }
.s-card.warn {
  background:linear-gradient(135deg,rgba(239,68,68,.06),rgba(239,68,68,.02));
  border-color:rgba(239,68,68,.2);
}
.s-card.warn .s-value { color:var(--red); }

/* ===== Breakdown ===== */
.breakdown-section { padding:0 16px 16px; }
.breakdown-title { font-size:15px; font-weight:600; margin-bottom:12px; display:flex; align-items:center; gap:8px; }
.breakdown-list { display:flex; flex-direction:column; gap:8px; }
.bd-item {
  display:flex; align-items:center; justify-content:space-between;
  padding:14px 16px; border-radius:var(--radius-sm);
  background:var(--surface); border:1px solid var(--border);
}
.bd-item .bd-left { display:flex; align-items:center; gap:10px; }
.bd-item .bd-dot { width:8px; height:8px; border-radius:50%; }
.bd-item .bd-name { font-size:14px; font-weight:500; }
.bd-item .bd-amount { font-family:'JetBrains Mono',monospace; font-size:15px; font-weight:600; }

/* ===== Bill Items (report detail list) ===== */
.bill-items { display:flex; flex-direction:column; gap:4px; margin-top:10px; }
.bill-item {
  display:flex; align-items:center; gap:10px;
  padding:10px 12px; border-radius:var(--radius-sm);
  background:var(--surface2);
}
.bill-item .bill-icon { font-size:16px; width:28px; text-align:center; flex-shrink:0; }
.bill-item .bill-info { flex:1; min-width:0; }
.bill-item .bill-name { font-size:13px; font-weight:500; display:flex; align-items:center; gap:6px; flex-wrap:wrap; }
.bill-item .bill-meta { font-size:11px; color:var(--text3); margin-top:2px; display:flex; align-items:center; gap:6px; }
.bill-item .bill-amount { font-family:'JetBrains Mono',monospace; font-size:13px; font-weight:600; flex-shrink:0; }

/* ===== Month Selector ===== */
.month-selector {
  display:flex; align-items:center; justify-content:center;
  gap:16px; padding:0 16px 16px;
}
.month-selector button {
  background:var(--surface); border:1px solid var(--border);
  color:var(--text); width:36px; height:36px;
  border-radius:50%; cursor:pointer;
  display:flex; align-items:center; justify-content:center; transition:all .2s;
}
.month-selector button:active { background:var(--surface3); }
.month-selector .month-label {
  font-size:17px; font-weight:600; min-width:120px; text-align:center;
  font-family:'JetBrains Mono',monospace;
}

/* ===== Transaction List ===== */
.tx-list { padding:0 16px 16px; display:flex; flex-direction:column; gap:14px; }
.tx-date-group {
  background:var(--surface); border-radius:var(--radius);
  border:1px solid var(--border); overflow:hidden;
}
.tx-date-header {
  display:flex; justify-content:space-between; align-items:center;
  padding:10px 16px; background:var(--surface2);
  font-size:13px; font-weight:600; color:var(--text2);
}
.tx-date-total { font-family:'JetBrains Mono',monospace; font-size:13px; color:var(--red); }
.tx-date-total.income { color:var(--accent); }
.tx-item {
  display:flex; align-items:center; padding:12px 16px;
  gap:12px; border-top:1px solid var(--border);
}
.tx-item .tx-icon {
  font-size:20px; width:36px; height:36px;
  display:flex; align-items:center; justify-content:center;
  border-radius:10px; background:var(--surface2); flex-shrink:0;
}
.tx-item .tx-info { flex:1; min-width:0; cursor:pointer; }
.tx-item .tx-title { font-size:14px; font-weight:500; display:flex; align-items:center; gap:6px; flex-wrap:wrap; }
.tx-item .tx-sub { font-size:12px; color:var(--text3); margin-top:2px; display:flex; align-items:center; gap:6px; flex-wrap:wrap; }
.tx-item .tx-right { display:flex; flex-direction:column; align-items:flex-end; gap:6px; flex-shrink:0; }
.tx-item .tx-amount {
  font-family:'JetBrains Mono',monospace; font-size:15px; font-weight:600; color:var(--red);
}
.tx-item .tx-amount.income { color:var(--accent); }
.tx-actions { display:flex; gap:4px; }
.tx-action-btn {
  background:none; border:none; font-size:14px; cursor:pointer;
  width:28px; height:28px; display:flex; align-items:center; justify-content:center;
  border-radius:6px; transition:background .15s;
}
.tx-action-btn:active { background:var(--surface3); }

.empty-state { text-align:center; padding:60px 20px; color:var(--text3); }
.empty-state .empty-icon { font-size:48px; margin-bottom:12px; opacity:.5; }
.empty-state .empty-text { font-size:14px; }

/* ===== Settings ===== */
.settings-section { padding:0 16px 16px; }
.settings-group-title {
  font-size:12px; color:var(--text3); font-weight:600;
  padding:0 4px; margin-bottom:8px; text-transform:uppercase; letter-spacing:.5px;
}
.settings-group {
  background:var(--surface); border-radius:var(--radius);
  border:1px solid var(--border); overflow:hidden; margin-bottom:16px;
}
.setting-row {
  display:flex; align-items:center; justify-content:space-between;
  padding:14px 16px; border-bottom:1px solid var(--border);
}
.setting-row:last-child { border-bottom:none; }
.setting-label { font-size:14px; font-weight:500; }
.setting-value {
  font-family:'JetBrains Mono',monospace; font-size:14px; color:var(--accent);
}
.setting-input {
  width:100px; text-align:right; background:transparent;
  border:none; color:var(--accent);
  font-family:'JetBrains Mono',monospace; font-size:14px; outline:none;
}
.card-row .card-info { display:flex; align-items:center; gap:8px; flex:1; min-width:0; flex-wrap:wrap; }
.card-dot { width:10px; height:10px; border-radius:50%; flex-shrink:0; }
.card-detail { font-size:12px; color:var(--text3); }
.card-actions { display:flex; gap:4px; flex-shrink:0; }
.icon-btn {
  background:none; border:none; font-size:16px; cursor:pointer;
  width:32px; height:32px; display:flex; align-items:center; justify-content:center;
  border-radius:8px; transition:background .15s;
}
.icon-btn:active { background:var(--surface3); }
.add-card-btn {
  background:none; border:1.5px dashed var(--border);
  color:var(--accent); font-size:14px; font-weight:500;
  padding:8px 20px; border-radius:var(--radius-sm);
  cursor:pointer; font-family:inherit; transition:all .2s;
}
.add-card-btn:active { background:var(--accent-dim); }

.action-btn {
  width:100%; padding:14px; background:var(--surface);
  border:1px solid var(--border); border-radius:var(--radius-sm);
  color:var(--text); font-size:14px; font-weight:500; cursor:pointer;
  font-family:inherit; transition:all .2s; margin-bottom:8px;
}
.action-btn:active { background:var(--surface3); }
.action-btn.danger { color:var(--red); border-color:rgba(239,68,68,.25); }

/* ===== Modal ===== */
.modal-overlay {
  position:fixed; inset:0; background:rgba(0,0,0,.5);
  z-index:300; display:none; align-items:flex-end; justify-content:center;
}
.modal-overlay.show { display:flex; }
.modal-sheet {
  background:var(--surface); border-radius:var(--radius) var(--radius) 0 0;
  width:100%; max-width:500px; max-height:85vh; overflow-y:auto;
  padding:20px 20px calc(20px + var(--safe-bottom));
  animation:sheetUp .25s ease-out;
}
@keyframes sheetUp { from { transform:translateY(100%); } to { transform:translateY(0); } }
.modal-header {
  display:flex; align-items:center; justify-content:space-between; margin-bottom:20px;
}
.modal-header .modal-title { font-size:18px; font-weight:700; }
.modal-header .modal-close {
  background:none; border:none; color:var(--text3); font-size:20px; cursor:pointer;
  width:32px; height:32px; display:flex; align-items:center; justify-content:center;
}
.modal-field { margin-bottom:16px; }
.modal-field label { display:block; font-size:13px; color:var(--text2); margin-bottom:6px; font-weight:500; }
.modal-input {
  width:100%; padding:12px 14px; background:var(--surface2);
  border:1.5px solid var(--border); border-radius:var(--radius-sm);
  color:var(--text); font-size:15px; font-family:inherit; outline:none;
  -webkit-appearance:none;
}
.modal-input:focus { border-color:var(--accent); }
select.modal-input { cursor:pointer; }
.modal-save {
  width:100%; padding:14px; background:var(--accent); color:#fff;
  border:none; border-radius:var(--radius-sm);
  font-size:15px; font-weight:700; cursor:pointer; font-family:inherit;
  transition:opacity .2s;
}
.modal-save:active { opacity:.8; }

/* Color Picker */
.color-picker { display:flex; gap:10px; flex-wrap:wrap; }
.color-dot {
  width:32px; height:32px; border-radius:50%; cursor:pointer;
  border:3px solid transparent; transition:all .15s;
  background:none; /* overridden inline */
}
.color-dot.active { border-color:var(--text); transform:scale(1.15); }

/* ===== Confirm Dialog ===== */
.dialog-overlay {
  position:fixed; inset:0; background:rgba(0,0,0,.4);
  z-index:400; display:none; align-items:center; justify-content:center; padding:20px;
}
.dialog-overlay.show { display:flex; }
.dialog-box {
  background:var(--surface); border-radius:var(--radius);
  padding:24px; max-width:300px; width:100%; text-align:center;
  box-shadow:0 8px 32px rgba(0,0,0,.12);
}
.dialog-title { font-size:17px; font-weight:700; margin-bottom:8px; }
.dialog-msg { font-size:14px; color:var(--text2); margin-bottom:20px; }
.dialog-btns { display:flex; gap:10px; }
.dialog-btns button {
  flex:1; padding:12px; border-radius:var(--radius-sm);
  font-size:14px; font-weight:600; cursor:pointer; border:none; font-family:inherit;
}
.cancel-btn { background:var(--surface2); color:var(--text); }
.confirm-btn { background:var(--red); color:#fff; }

/* ===== Toast ===== */
.toast {
  position:fixed; top:calc(var(--safe-top) + 16px);
  left:50%; transform:translateX(-50%) translateY(-100px);
  padding:12px 24px; border-radius:12px;
  background:rgba(16,185,129,.95); color:#fff;
  font-size:14px; font-weight:600; z-index:500;
  transition:transform .3s cubic-bezier(.34,1.56,.64,1);
}
.toast.show { transform:translateX(-50%) translateY(0); }
.toast.error { background:rgba(239,68,68,.95); }
